const DisplayMode={FIXED:"fixed",POPOVER:"popover",TOOLTIP:"tooltip"};class WYSIWYGEditor{#a;#b;#c;#d;#e;#f;constructor(t,e=DisplayMode.FIXED){if(this.#a=document.getElementById(t),!Object.values(DisplayMode).includes(e))throw Error("Invalid display mode, please use DisplayMode enum");this.#b=e}init(){this.#g(),this.#h()}#g(){this.#b==DisplayMode.POPOVER||this.#b==DisplayMode.TOOLTIP?this.#i():this.#j(),this.#d=this.#c.querySelectorAll("button[data-command]"),this.#d.length>0&&this.#k(),this.#c.querySelector(".wysiwyg-toolbar-dropdown")&&this.#l()}#j(){let t=this.#a.querySelector(".wysiwyg-toolbar");t?(t.classList.add("wysiwyg-toolbar--fixed"),this.#c=t):(this.#a.insertAdjacentHTML("afterbegin",'<div class="wysiwyg-toolbar wysiwyg-toolbar--fixed"></div>'),this.#c=this.#a.querySelector(".wysiwyg-toolbar"),this.#c.innerHTML=this.#m())}#i(){let e=this.#a.querySelector(".wysiwyg-toolbar");e?(this.#c=e,this.#a.removeChild(this.#c)):(this.#c=document.createElement("div"),this.#c.classList.add("wysiwyg-toolbar"),this.#c.innerHTML=this.#m()),this.#c.classList.add(`wysiwyg-toolbar--${this.#b}`),document.body.appendChild(this.#c)}#m(){return`
            <div class="wysiwyg-toolbar-group">
                
                <div class="wysiwyg-toolbar-dropdown">
                    <div class="wysiwyg-toolbar-dropdown-toggle">
                        <span>Normal</span>
                    </div>
                    <div class="wysiwyg-toolbar-dropdown-content">
                        <button type="button" data-command="fontSize" data-value="7">
                            <span>Huge</span>
                        </button>
                        <button type="button" data-command="fontSize" data-value="5">
                            <span>Large</span>
                        </button>
                        <button type="button" data-command="fontSize" data-value="3">
                            <span>Normal</span>
                        </button>
                        <button type="button" data-command="fontSize" data-value="1">
                            <span>Small</span>
                        </button>
                    </div>
                </div>
            
                
                <div class="wysiwyg-toolbar-dropdown">
                    <div class="wysiwyg-toolbar-dropdown-toggle">
                        <span>Sans-Serif</span>
                    </div>
                    <div class="wysiwyg-toolbar-dropdown-content">
                        <button type="button" data-command="fontName" data-value="sans-serif" style="font-family:sans-serif;">
                            <span>Sans-Serif</span>
                        </button>
                        <button type="button" data-command="fontName" data-value="serif" style="font-family:serif;">
                            <span>Serif</span>
                        </button>
                        <button type="button" data-command="fontName" data-value="monospace" style="font-family:monospace;">
                            <span>Monospace</span>
                        </button>
                    </div>
                </div>
            
            </div>
            <div class="wysiwyg-toolbar-group">
                
                <button type="button" data-command="bold" style="font-weight:bold;">
                    <span>B</span>
                </button>
                <button type="button" data-command="italic" style="font-style:italic;padding-right:10px;">
                    <span>I</span>
                </button>
                <button type="button" data-command="underline" style="text-decoration:underline;">
                    <span>U</span>
                </button>
                <button type="button" data-command="strikeThrough" style="text-decoration:line-through;">
                    <span>S</span>
                </button>
            
            </div>
            <div class="wysiwyg-toolbar-group">
                
                <button type="button" data-command="justifyLeft">
                    <span>L</span>
                </button>
                <button type="button" data-command="justifyCenter">
                    <span>C</span>
                </button>
                <button type="button" data-command="justifyRight">
                    <span>R</span>
                </button>
                <button type="button" data-command="justifyFull">
                    <span>J</span>
                </button>
            
            </div>
            <div class="wysiwyg-toolbar-group">
                
                <button type="button" data-command="indent">
                    <span>Indent</span>
                </button>
                <button type="button" data-command="outdent">
                    <span>Outdent</span>
                </button>
            
                
                <button type="button" data-command="insertUnorderedList">
                    <span>UL</span>
                </button>
                <button type="button" data-command="insertOrderedList">
                    <span>OL</span>
                </button>
            
            </div>
            <div class="wysiwyg-toolbar-group">
                
                <div class="wysiwyg-toolbar-dropdown">
                    <div class="wysiwyg-toolbar-dropdown-toggle">
                        <span>Link</span>
                    </div>
                    <div class="wysiwyg-toolbar-dropdown-content">
                        <input type="url" data-command="createLink" placeholder="https://example.com">
                    </div>
                </div>
            
                
                <div class="wysiwyg-toolbar-dropdown">
                    <div class="wysiwyg-toolbar-dropdown-toggle">
                        <span>Image Link</span>
                    </div>
                    <div class="wysiwyg-toolbar-dropdown-content">
                        <input type="url" data-command="uploadImage" placeholder="https://example.com">
                    </div>
                </div>
            
                
                <button type="button" data-command="insertImage">
                    <span>Image</span>
                </button>
            
                
                <button type="button" data-command="unlink">
                    <span>Unlink</span>
                </button>
            
            </div>
            <div class="wysiwyg-toolbar-group">
                
                <button type="button" data-command="removeFormat">
                    <span>Clear</span>
                </button>
                <button type="button" data-command="undo">
                    <span>Undo</span>
                </button>
                <button type="button" data-command="redo">
                    <span>Redo</span>
                </button>
            
            </div>
        `}#n(){let o=document.createElement("input");o.type="file",o.accept="image/*",o.multiple=!0,o.click(),o.addEventListener("change",()=>{let t=o.files;0!==t.length&&new Promise(e=>{let o=t.length;for(let a of t){let n=new FileReader;n.onload=()=>{if(this.#f){let a=window.getSelection();a.removeAllRanges(),a.addRange(this.#f)}else this.#e.focus();document.execCommand("insertImage",!1,n.result),0==--o&&e(t)},n.readAsDataURL(a)}}).then(t=>{this.#e.querySelectorAll("img").forEach((e,o)=>{e.style.width="100%",e.addEventListener("mouseover",()=>{e.title=t[o].name})}),o.value=""})})}#k(){this.#d.forEach(t=>{t.getAttribute("type")||t.setAttribute("type","button"),t.addEventListener("click",()=>{t.dataset.command.includes("justify")&&this.#c.querySelectorAll('[data-command^="justify"]').forEach(t=>t.classList.remove("active")),document.execCommand(t.dataset.command,!1,t.dataset.value),t.classList.toggle("active"),this.#e.focus()})});let a=this.#c.querySelector('[data-command="insertImage"]');a&&a.addEventListener("click",async()=>{this.#n()})}#o(n,s,i=null,d=null){n.parentElement.previousElementSibling.addEventListener("click",()=>{let t=document.getSelection();0!==t.rangeCount&&(this.#f=t.getRangeAt(0),i&&i(n,t))}),n.addEventListener("keypress",t=>{if("Enter"===t.key){t.preventDefault();let e=window.getSelection();this.#f?(e.removeAllRanges(),e.addRange(this.#f)):this.#e.focus(),document.execCommand(s,!1,n.value),d&&d(n)}})}#p(l){this.#o(l,"createLink",(t,e)=>{e="A"===e.anchorNode.parentElement.tagName?e.anchorNode.parentElement.href:e.toString(),t.value=e},()=>{this.#e.querySelectorAll("a").forEach(t=>{t.target="_blank",t.title=t.href,t.innerHTML=t.querySelector("span")?.innerHTML||t.innerHTML,t.addEventListener("click",e=>{e.ctrlKey&&window.open(t.href,"_blank")}),t.addEventListener("mouseover",()=>{document.addEventListener("keydown",e=>{e.ctrlKey&&(t.style.cursor="pointer")}),document.addEventListener("keyup",()=>{t.style.cursor="text"})}),t.addEventListener("mouseout",()=>{t.style.cursor="text"})})})}#q(r){this.#o(r,"insertImage",null,()=>{this.#e.querySelectorAll("img").forEach(t=>{t.style.width="100%",t.title=t.src})})}#l(){this.#c.querySelectorAll(".wysiwyg-toolbar-dropdown-toggle").forEach(t=>{t.addEventListener("click",()=>{this.#c.querySelectorAll(".wysiwyg-toolbar-dropdown-content.show").forEach(e=>{e!==t.nextElementSibling&&e.classList.remove("show")}),t.nextElementSibling.classList.toggle("show")})}),document.addEventListener("click",t=>{t.target.closest(".wysiwyg-toolbar-dropdown")||this.#c.querySelectorAll(".wysiwyg-toolbar-dropdown-content").forEach(t=>{t.classList.remove("show")})}),this.#c.querySelectorAll(".wysiwyg-toolbar-dropdown-content button").forEach(t=>{t.addEventListener("click",()=>{t.parentElement.previousElementSibling.querySelector("span").innerText=t.innerText,t.parentElement.classList.remove("show")})});let y=this.#c.querySelector('input[data-command="createLink"]');y&&this.#p(y);let c=this.#c.querySelector('input[data-command="uploadImage"]');c&&this.#q(c)}#h(){this.#b==DisplayMode.POPOVER||this.#b==DisplayMode.TOOLTIP?this.#r():this.#s(),this.#t(this.#e),this.#u()}#s(){let b=this.#a.querySelector(".wysiwyg-body");this.#e=b,this.#e||(this.#e=document.createElement("div"),this.#e.classList.add("wysiwyg-body"),this.#a.appendChild(this.#e)),this.#e.setAttribute("contenteditable",!0),this.#e.innerHTML=this.#e.innerHTML.replace(/\s+/g," ").trim()}#r(){let p=this.#a.querySelector(".wysiwyg-body");p&&this.#a.removeChild(p),this.#e=this.#a,p&&(this.#e.innerHTML=p.innerHTML.trim()),this.#e.classList.add("wysiwyg-body"),this.#e.setAttribute("contenteditable",!0)}#v(){document.addEventListener("selectionchange",t=>{this.#e!==document.activeElement||(this.#d.forEach(t=>{t.classList.toggle("active",document.queryCommandState(t.dataset.command))}),this.#b!=DisplayMode.TOOLTIP||this.#c.contains(t.target)||""!==document.getSelection().toString()&&0!==document.getSelection().rangeCount||(this.#c.style.display="none"))})}#w(){this.#e.addEventListener("blur",()=>{document.addEventListener("click",t=>{this.#e.contains(t.target)||this.#c.contains(t.target)||(this.#c.style.display="none")})})}#x(){this.#e.addEventListener("focus",()=>{this.#c.style.display="block",this.#c.style.top=`${this.#e.offsetTop-this.#c.offsetHeight}px`,this.#c.style.left=`${this.#e.offsetLeft}px`})}#y(){this.#e.addEventListener("mouseup",()=>{let t=document.getSelection();if(""!==t.toString()&&t.rangeCount>0){this.#c.style.display="block";let e=t.getRangeAt(0).getBoundingClientRect();this.#c.style.top=`${e.top+window.scrollY-this.#c.offsetHeight}px`,this.#c.style.left=`${e.left+window.scrollX}px`}})}#z(){this.#e.addEventListener("paste",t=>{let e=t.clipboardData.getData("text");e.match(/^https?:\/\/.+/)&&(document.execCommand("createLink",!1,e),t.preventDefault(),this.#e.querySelectorAll("a").forEach(t=>{t.target="_blank",t.title=t.href,t.innerHTML=t.querySelector("span")?.innerHTML||t.innerHTML,t.addEventListener("click",e=>{e.ctrlKey&&window.open(t.href,"_blank")}),t.addEventListener("mouseover",()=>{document.addEventListener("keydown",e=>{e.ctrlKey&&(t.style.cursor="pointer")}),document.addEventListener("keyup",()=>{t.style.cursor="text"})}),t.addEventListener("mouseout",()=>{t.style.cursor="text"})}))})}#u(){this.#v(),this.#b!=DisplayMode.FIXED&&this.#w(),this.#b==DisplayMode.POPOVER&&this.#x(),this.#b==DisplayMode.TOOLTIP&&this.#y(),this.#z()}#t(u){for(let h=0;h<u.childNodes.length;h++)3===u.childNodes[h].nodeType&&""===u.childNodes[h].nodeValue.trim()?u.removeChild(u.childNodes[h]):1===u.childNodes[h].nodeType&&this.#t(u.childNodes[h])}getTextContent(){return this.#e.innerText}getHTMLContent(){let t=this.#e.querySelector("iframe")?.contentWindow.document.body.outerHTML;return this.#e.innerHTML.replace("<iframe>","").replace("</iframe>","")+(t?"<iframe>"+t+"</iframe>":"")}addHTMLContent(t){this.#e.innerHTML+=t}addTextContent(t){this.#e.innerText+=t}setHTMLContent(t){this.#e.innerHTML=t}setTextContent(t){this.#e.innerText=t}addFullHTMLPage(t){let e=document.createElement("iframe");this.#e.appendChild(document.createElement("br")),this.#e.appendChild(e),(e=e.contentWindow?e.contentWindow.document:e.document).open(),e.writeln(t),e.close(),e.querySelector("body").setAttribute("contenteditable",!0)}clearContent(){this.#e.innerHTML=""}onChange(t){let e=new MutationObserver(()=>{t(this.getHTMLContent())});e.observe(this.#e,{childList:!0,subtree:!0,characterData:!0}),this.#d.forEach(e=>{e.addEventListener("click",()=>{t(this.getHTMLContent())})})}}
